<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Project Euler Problem 64 &#8211; Art is Never Finished</title>
<meta name="description" content="I don’t know how I managed to avoid learning about the properties of continued fractions in school; I can only blame the textbook authors for not including the material. Continued fractions are really quite remarkable; have you ever wondered why some rational fractions (e.g. 1/3) take infinitely many decimals to represent (0.3333…), while other fractions (e.g. 1/4) have a finite representation (0.25)? Or why if you represent these fractions in a different base (e.g. hexadecimal) then they may take a different finite or even infinite number of digits to represent?
">
<meta name="keywords" content="continued fractions, repeating decimal">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Project Euler Problem 64">
<meta name="twitter:description" content="I don’t know how I managed to avoid learning about the properties of continued fractions in school; I can only blame the textbook authors for not including the material. Continued fractions are really quite remarkable; have you ever wondered why some rational fractions (e.g. 1/3) take infinitely many decimals to represent (0.3333…), while other fractions (e.g. 1/4) have a finite representation (0.25)? Or why if you represent these fractions in a different base (e.g. hexadecimal) then they may take a different finite or even infinite number of digits to represent?
">
<meta name="twitter:site" content="@ivarthorson">
<meta name="twitter:creator" content="@ivarthorson">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Project Euler Problem 64">
<meta property="og:description" content="I don’t know how I managed to avoid learning about the properties of continued fractions in school; I can only blame the textbook authors for not including the material. Continued fractions are really quite remarkable; have you ever wondered why some rational fractions (e.g. 1/3) take infinitely many decimals to represent (0.3333…), while other fractions (e.g. 1/4) have a finite representation (0.25)? Or why if you represent these fractions in a different base (e.g. hexadecimal) then they may take a different finite or even infinite number of digits to represent?
">
<meta property="og:url" content="/project-euler/problem-64/">
<meta property="og:site_name" content="Art is Never Finished">





<link rel="canonical" href="/project-euler/problem-64/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Art is Never Finished Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="/assets/js/vendor/html5shiv.min.js"></script>
  <script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="/about/" >About</a></li>
		  
		    
		    <li><a href="/blog/" >Blog</a></li>
		  
		    
		    <li><a href="/project-euler/" >Code</a></li>
		  
		    
		    <li><a href="/search/" >Search</a></li>
		  
		    
		    <li><a href="/tags/" >Tags</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="/">Art is Never Finished</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">...Only Abandoned. – Leonardo da Vinci</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#continued fractions" title="Pages tagged continued fractions">continued fractions</a></li><li><a href="/tags/#repeating decimal" title="Pages tagged repeating decimal">repeating decimal</a></li>
        </ul>
        
          <h1 class="entry-title">Project Euler Problem 64</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="/images/ivar.jpg" class="bio-photo" alt="Ivar Thorson bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Ivar Thorson</span></span>
        <span class="entry-date date published"><time datetime="2010-08-24T09:19:22+00:00"><i class="fa fa-calendar-o"></i> August 24, 2010</time></span>
        
        
        
        
      </footer>
      <div class="entry-content">
        <p>I don’t know how I managed to avoid learning about the properties of <a href="http://en.wikipedia.org/wiki/Continued_fractions">continued fractions</a> in school; I can only blame the textbook authors for not including the material. Continued fractions are really quite remarkable; have you ever wondered why some rational fractions (e.g. 1/3) take infinitely many decimals to represent (0.3333…), while other fractions (e.g. 1/4) have a finite representation (0.25)? Or why if you represent these fractions in a different base (e.g. hexadecimal) then they may take a different finite or even infinite number of digits to represent?</p>

<p>Continued fractions give a mathematically pure way to describe rational fractions that isn’t dependent on some particular base counting system. Even more amazingly to me, many ‘irrational’ numbers such as square roots become repeating patterns when represented as continued fractions! Surely this says something fundamental about the nature of square roots, perhaps they are a very simple type of irrational number.</p>

<p><a href="http://projecteuler.net/index.php?section=problems&amp;id=64">Problem 64</a> asks us to find the quantity of numbers under 1000 whose square roots have an odd-length period. My first approach was to use a mathematically simple definition and general definition:</p>

<pre><code>(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">continuous-fraction</span>
  <span style="color: #888a85;">"Returns a sequence of the coefficicents of the continuing fraction
  that is equivilent to n."</span>
  [n]
  (<span style="color: #729fcf;">rest</span> (<span style="color: #729fcf;">iterate</span> (<span style="color: #729fcf;">fn</span> [[x i]]
                   (<span style="color: #8ae234;">if</span> (<span style="color: #729fcf;">=</span> i (<span style="color: #729fcf;">int</span> i))
                     [i 0]
                     [(<span style="color: #729fcf;">int</span> i) (<span style="color: #729fcf;">/</span> 1 (<span style="color: #729fcf;">-</span> i (<span style="color: #729fcf;">int</span> i)))]))
                 [0 n])))

(<span style="color: #729fcf;">take</span> 10 (continuous-fraction (sqrt 2)))</code></pre>

<p>Unfortunately for this simple definition, if you look at the sequence it generates, you can see numerical noise creep into the remainder. This would prevent us from easily testing whether the sequence is repeating or not in a manner similar to what we did in <a href="index.php?p=276">problem 24</a>.</p>

<p>Still, if we use <a href="http://en.wikipedia.org/wiki/Methods_of_computing_square_roots#Continued_fraction_expansion">an algorithm</a> similar to the famous <a href="http://en.wikipedia.org/wiki/Euclidean_Algorithm">Euclidean Algorithm</a> for finding the <a href="http://en.wikipedia.org/wiki/Greatest_common_divisor">greatest common divisor</a>, we can write a sequence generator that does not suffer from numerical precision problems.</p>

<pre><code>(<span style="color: #729fcf;">use</span> '[clojure.contrib.math <span style="color: #729fcf;">:only</span> (sqrt)])

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">continued-fraction-sqrt</span>
  <span style="color: #888a85;">"Returns a sequence of the coefficicents of the continued fraction
  that is equivilent to the square root of n, which must not be a simple square."</span>
  [n]
  (<span style="color: #729fcf;">iterate</span> (<span style="color: #729fcf;">fn</span> [[a m d]]
             (<span style="color: #8ae234;">let</span> [m+ (<span style="color: #729fcf;">-</span> (<span style="color: #729fcf;">*</span> d a) m)
                   d+ (<span style="color: #729fcf;">/</span> (<span style="color: #729fcf;">-</span> n (<span style="color: #729fcf;">*</span> m+ m+)) d)
                   a+ (<span style="color: #729fcf;">int</span> (<span style="color: #729fcf;">/</span> (<span style="color: #729fcf;">+</span> m+ (sqrt n)) d+))]
               [a+ m+ d+]))
           [(<span style="color: #729fcf;">int</span> (sqrt n)) 0 1]))

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">period-length</span>
  <span style="color: #888a85;">"Returns the length of the periodic sequence found in coll, or nil if the
  end of the sequence is reached without a pattern being found. "</span>
  [coll]
  (<span style="color: #8ae234;">loop</span> [m {}
         i 0
         c coll]
    (<span style="color: #8ae234;">and</span> (<span style="color: #729fcf;">seq</span> c)
         (<span style="color: #8ae234;">let</span> [k (<span style="color: #729fcf;">first</span> c)]
           (<span style="color: #8ae234;">if-let</span> [v (m k)] 
             (<span style="color: #729fcf;">-</span> i v)
             (<span style="color: #8ae234;">recur</span> (<span style="color: #729fcf;">assoc</span> m k i)
                    (<span style="color: #729fcf;">inc</span> i)
                    (<span style="color: #729fcf;">next</span> c)))))))

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">square?</span> [n]
  (<span style="color: #729fcf;">=</span> n (<span style="color: #729fcf;">*</span> (<span style="color: #729fcf;">int</span> (sqrt n)) (<span style="color: #729fcf;">int</span> (sqrt n)))))

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">euler-64</span> []
  (<span style="color: #729fcf;">count</span> (<span style="color: #729fcf;">filter</span> odd? (<span style="color: #729fcf;">map</span> #(period-length (continued-fraction-sqrt %))
                           (<span style="color: #729fcf;">remove</span> square? (<span style="color: #729fcf;">range</span> 1 10000))))))

(<span style="color: #729fcf;">time</span> (euler-64)) <span style="color: #A8AaA5;">;; </span><span style="color: #A8AaA5;">"Elapsed time: 867.320304 msecs"
</span></code></pre>

<p>All in all, a rather mathematically interesting problem!</p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/project-euler/problem-63/" class="btn" title="Project Euler Problem 63">Previous</a>
      
      
        <a href="/project-euler/problem-65/" class="btn" title="Project Euler Problem 65">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<div>&copy; 2020 Ivar Thorson. </div>
<div class="legaltext">Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a modified version of the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</div>
<div class="social-icons">
	<a href="https://twitter.com/ivarthorson" title="Ivar Thorson on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	
	
	
	
	<a href="https://github.com/ivarthorson" title="Ivar Thorson on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = '';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
