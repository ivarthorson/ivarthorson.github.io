<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Project Euler Problem 60 &#8211; Art is Never Finished</title>
<meta name="description" content="This was challenging! Problem 60 asks us to find the sum of five primes, any pair of which must – when concatenated in any order – form another prime.

">
<meta name="keywords" content="combinations, primes">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Project Euler Problem 60">
<meta name="twitter:description" content="This was challenging! Problem 60 asks us to find the sum of five primes, any pair of which must – when concatenated in any order – form another prime.

">
<meta name="twitter:site" content="@ivarthorson">
<meta name="twitter:creator" content="@ivarthorson">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ivarthorson.github.io/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Project Euler Problem 60">
<meta property="og:description" content="This was challenging! Problem 60 asks us to find the sum of five primes, any pair of which must – when concatenated in any order – form another prime.

">
<meta property="og:url" content="https://ivarthorson.github.io/project-euler/problem-60/">
<meta property="og:site_name" content="Art is Never Finished">





<link rel="canonical" href="https://ivarthorson.github.io/project-euler/problem-60/">
<link href="https://ivarthorson.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Art is Never Finished Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://ivarthorson.github.io/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="https://ivarthorson.github.io/assets/js/vendor/html5shiv.min.js"></script>
  <script src="https://ivarthorson.github.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://ivarthorson.github.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://ivarthorson.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://ivarthorson.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://ivarthorson.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://ivarthorson.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://ivarthorson.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://ivarthorson.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="https://ivarthorson.github.io/about/" >About</a></li>
		  
		    
		    <li><a href="https://ivarthorson.github.io/blog/" >Blog</a></li>
		  
		    
		    <li><a href="https://ivarthorson.github.io/project-euler/" >Code</a></li>
		  
		    
		    <li><a href="https://ivarthorson.github.io/search/" >Search</a></li>
		  
		    
		    <li><a href="https://ivarthorson.github.io/tags/" >Tags</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="https://ivarthorson.github.io/">Art is Never Finished</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">...Only Abandoned. – Leonardo da Vinci</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="https://ivarthorson.github.io/tags/#combinations" title="Pages tagged combinations">combinations</a></li><li><a href="https://ivarthorson.github.io/tags/#primes" title="Pages tagged primes">primes</a></li>
        </ul>
        
          <h1 class="entry-title">Project Euler Problem 60</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="https://ivarthorson.github.io/images/ivar.jpg" class="bio-photo" alt="Ivar Thorson bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Ivar Thorson</span></span>
        <span class="entry-date date published"><time datetime="2010-08-20T01:58:21-07:00"><i class="fa fa-calendar-o"></i> August 20, 2010</time></span>
        
        
        
        
      </footer>
      <div class="entry-content">
        <p>This was challenging! <a href="http://projecteuler.net/index.php?section=problems&amp;id=60">Problem 60</a> asks us to find the sum of five primes, any pair of which must – when concatenated in any order – form another prime.</p>

<p>If you assume (incorrectly) that finding concatenatable primes in order will bring about the minimum sum, you may write (broken) code that looks like this:</p>

<pre><code>(<span style="color: #729fcf;">use</span> '[clojure.contrib.lazy-seqs <span style="color: #729fcf;">:only</span> (primes)])

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">prime?</span> [n]
  (<span style="color: #8ae234;">and</span> (<span style="color: #729fcf;">&lt;</span> 1 n) (<span style="color: #729fcf;">not-any?</span> #(zero? (<span style="color: #729fcf;">rem</span> n %)) (<span style="color: #729fcf;">take-while</span> #(<span style="color: #729fcf;">&lt;=</span> (<span style="color: #729fcf;">*</span> % %) n) primes))))

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">all-pairs-prime?</span>
  <span style="color: #888a85;">"Returns true iff p forms only prime numbers when concatenated with elements is coll."</span>
  [coll p]
  (<span style="color: #8ae234;">let</span> [pairs (<span style="color: #729fcf;">mapcat</span> (<span style="color: #729fcf;">fn</span> [a b] [[a b] [b a]]) coll (<span style="color: #729fcf;">repeat</span> p))
        nums (<span style="color: #729fcf;">map</span> (<span style="color: #729fcf;">fn</span> [[a b]] (<span style="color: #729fcf;">bigint</span> (<span style="color: #729fcf;">apply</span> str (<span style="color: #729fcf;">concat</span> (<span style="color: #729fcf;">str</span> a) (<span style="color: #729fcf;">str</span> b))))) pairs)]
    (<span style="color: #729fcf;">every?</span> prime? nums)))

(<span style="color: #8ae234;">def</span> <span style="color: #edd400; font-weight: bold;">concatenatable-primes</span>
     (<span style="color: #729fcf;">iterate</span> (<span style="color: #729fcf;">fn</span> [c]
                (<span style="color: #729fcf;">conj</span> c (<span style="color: #729fcf;">first</span>
                         (<span style="color: #729fcf;">filter</span> #(all-pairs-prime? c %)
                                 (<span style="color: #729fcf;">drop-while</span> #(<span style="color: #729fcf;">&lt;</span> % (<span style="color: #729fcf;">apply</span> max c)) primes)))))
              [3]))

(<span style="color: #729fcf;">take</span> 4 concatenatable-primes) <span style="color: #A8AaA5;">;; </span><span style="color: #A8AaA5;">([3] [3 7] [3 7 109] [3 7 109 673])
</span>
(<span style="color: #729fcf;">take</span> 5 concatenatable-primes) <span style="color: #A8AaA5;">;; </span><span style="color: #A8AaA5;">ka-BOOOM! Doesn't seem to ever finish.
</span></code></pre>

<p>After wasting an embarrassingly long amount of time trying to figure out why this was either incorrect (or why the performance was so terrible that it wasn’t computing the answer in a reasonable amount of time), I sat back and rethought my assumptions, and tried an algorithm that would try more possibilities.</p>

<p>But before we get to that algorithm, let’s improve that awful <code class="highlighter-rouge">all-pairs-prime?</code> a little because we will certainly need to use it again.</p>

<pre><code>(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">all-pairs-prime?</span>
  <span style="color: #888a85;">"Returns true iff p forms only prime numbers when concatenated in any order
  with an element of coll."</span>
  [coll p]
  (<span style="color: #729fcf;">every?</span> prime? (<span style="color: #729fcf;">interleave</span> (<span style="color: #729fcf;">map</span> #(<span style="color: #729fcf;">bigint</span> (<span style="color: #729fcf;">str</span> p %)) coll)
                             (<span style="color: #729fcf;">map</span> #(<span style="color: #729fcf;">bigint</span> (<span style="color: #729fcf;">str</span> % p)) coll))))</code></pre>

<p>Ahh, that’s much more concise and to the point. But wait: could performance be improved if avoid the integers-&gt;strings-&gt;bigint type conversion? As it turns out, this next version use logarithms to find the number of digits in each number, and as a result goes about twice as fast as the above:</p>

<pre><code>(<span style="color: #729fcf;">use</span> '[clojure.contrib.math <span style="color: #729fcf;">:only</span> (expt)])

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">x10</span> [n] (expt 10 (<span style="color: #729fcf;">inc</span> (<span style="color: #729fcf;">quot</span> (Math/log n) (Math/log 10)))))

(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">all-pairs-prime?</span>
  <span style="color: #888a85;">"Returns true iff p forms only prime numbers when concatenated in any order
  with an element of coll."</span>
  [coll p]
  (<span style="color: #729fcf;">every?</span> prime? (<span style="color: #729fcf;">interleave</span> (<span style="color: #729fcf;">map</span> #(<span style="color: #729fcf;">+</span> % (<span style="color: #729fcf;">*</span> p (x10 %))) coll)
                             (<span style="color: #729fcf;">map</span> #(<span style="color: #729fcf;">+</span> p (<span style="color: #729fcf;">*</span> % (x10 p))) coll))))</code></pre>

<p>Now let’s correct the core algorithm of this problem. Rather than assume that the solution for five concatenatable primes will use the smallest four concatenatable primes plus one more prime, let’s go back to building a list of five primes from scratch. That is, we will start with a list of prime numbers, build up pairs of concatenatable primes in this list, then triplets, then quadruplets, and finally groups of five. Returning the first of these should give the correct answer.</p>

<p>For performance reasons, we want the starting list of candidate prime numbers to be as small as possible and yet still contain all five concatenatable prime numbers. I didn’t see any obvious hints, so I first just guessed that the first five primes were under 1000. This didn’t work, but when I tried 10,000 then the following code solved the problem.</p>

<pre><code>(<span style="color: #8ae234;">defn</span> <span style="color: #edd400; font-weight: bold;">euler-60</span> []
  (<span style="color: #8ae234;">let</span> [ps (<span style="color: #729fcf;">take-while</span> #(<span style="color: #729fcf;">&lt;</span> % 10000) primes)]
    (<span style="color: #729fcf;">first</span>
     (<span style="color: #8ae234;">for</span> [a ps
           b (<span style="color: #729fcf;">filter</span> #(all-pairs-prime? [a] %) (<span style="color: #729fcf;">drop-while</span> #(<span style="color: #729fcf;">&lt;=</span> % a) ps))
           c (<span style="color: #729fcf;">filter</span> #(all-pairs-prime? [a b] %) (<span style="color: #729fcf;">drop-while</span> #(<span style="color: #729fcf;">&lt;=</span> % b) ps))
           d (<span style="color: #729fcf;">filter</span> #(all-pairs-prime? [a b c] %) (<span style="color: #729fcf;">drop-while</span> #(<span style="color: #729fcf;">&lt;=</span> % c) ps))
           e (<span style="color: #729fcf;">filter</span> #(all-pairs-prime? [a b c d] %) (<span style="color: #729fcf;">drop-while</span> #(<span style="color: #729fcf;">&lt;=</span> % d) ps))]
       (<span style="color: #729fcf;">+</span> a b c d e)))))

(<span style="color: #729fcf;">time</span> (euler-60)) <span style="color: #A8AaA5;">;; </span><span style="color: #A8AaA5;">"Elapsed time: 16474.689447 msecs"
</span></code></pre>

<p>The somewhat slow performance of this leaves something to be desired, but this solution seems easy to understand, is concise, and gives the correct answer. Suggestions on a better algorithm are welcome.</p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="https://ivarthorson.github.io/project-euler/problem-59/" class="btn" title="Project Euler Problem 59">Previous</a>
      
      
        <a href="https://ivarthorson.github.io/project-euler/problem-61/" class="btn" title="Project Euler Problem 61">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<div>&copy; 2017 Ivar Thorson. </div>
<div class="legaltext">Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using a modified version of the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</div>
<div class="social-icons">
	<a href="https://twitter.com/ivarthorson" title="Ivar Thorson on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	
	
	
	
	<a href="https://github.com/ivarthorson" title="Ivar Thorson on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="https://ivarthorson.github.io/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'https://ivarthorson.github.io';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://ivarthorson.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://ivarthorson.github.io/assets/js/scripts.min.js"></script>




</body>
</html>
